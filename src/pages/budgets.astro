---
import DonutChart from "@components/DonutChart.astro";
import Layout from "../layouts/Layout.astro";
import type BudgetType from "../lib/budget.ts";
import data from "../data.json";
import SpendingSummary from "@components/SpendingSummary.astro";
import BudgetComponent from "@components/BudgetComponent.astro";

const refinedData: BudgetType[] = [];
data.budgets.forEach((budget) => {
	let item: BudgetType = {
		label: budget.category,
		spent: 0,
		maximum: budget.maximum,
		theme: budget.theme,
	};
	data.transactions.forEach((transaction) => {
		if (transaction.category === budget.category) {
			item.spent += transaction.amount;
		}
	});

	refinedData.push(item);
});
refinedData.forEach((item) => {
	item.spent = item.spent * -1;
});

let budgetCategories: string[] = [];
let spent: number = 0;
let maximum: number = 0;

data.budgets.forEach((budget) => {
	maximum += budget.maximum;
	budgetCategories.push(budget.category);
});

data.transactions.forEach((transaction) => {
	if (budgetCategories.includes(transaction.category)) {
		spent += transaction.amount;
	}
});
---

<Layout title="Welcome to Astro.">
	<main>
		<section>
			<h1>Budgets</h1>
			<button>+ Add New Budget</button>
		</section>

		<section class="donutSection">
			<div class="donutWrapper">
				<DonutChart />
				<div class="budgetSummary">
					<h2>${(spent * -1).toFixed(2)}</h2>
					<p>of ${maximum.toFixed(2)} limit</p>
				</div>
			</div>
			<div class="spendingSummary">
				<h2 class="sectionTitle">Spending summary</h2>
				<div class="spendingSummaryWrapper">
					{
						refinedData.map((item) => (
							<SpendingSummary
								label={item.label}
								spent={item.spent}
								maximum={item.maximum}
								theme={item.theme}
							/>
						))
					}
				</div>
			</div>
		</section>
		<section class="budgetSection">
			{
				refinedData.map((item) => (
					<BudgetComponent
						label={item.label}
						maximum={item.maximum}
						spent={item.spent}
						theme={item.theme}
					/>
				))
			}
		</section>

		<!-- Add New Budget Choose a category to set a spending budget. These categories
		can help you monitor spending. Edit Budget As your budgets change, feel free
		to update your spending limits. Budget Category Entertainment Bills
		Groceries Dining Out Transportation Personal Care Education Lifestyle
		Shopping General Maximum Spend Theme Green Yellow Cyan Navy Red Purple
		Turquoise Brown Magenta Blue Navy Grey Army Green Pink Gold Orange Add
		Budget / Save Changes -->

		<!-- Delete ' budget name ' Are you sure you want to delete this budget?
		This action cannot be reversed, and all the data inside it will be removed
		forever. Yes, Confirm Deletion No, Go Back -->
	</main>

	<style>
		main {
			display: flex;
			flex-direction: column;
			margin-inline: auto;
			padding: 1rem;
			width: 100%;
			margin-block-end: 5rem;
		}
		h1 {
			font-size: var(--fs-heading-1);
			color: var(--primary-100);
			/* margin-block: 5rem 3rem; */
		}

		section {
			background-color: var(--primary-900);
			/* padding-inline: 1rem; */
			padding: 1.5rem;
			border-radius: 0.75rem;
			&:first-of-type {
				background-color: var(--neutral-light-beige);
				display: flex;
				flex-direction: row;
				justify-content: space-between;
				margin-block: 2rem 3rem;
				padding: 0;
				button {
					background-color: var(--primary-100);
					color: var(--primary-900);
					border: 0;
					border-radius: 0.25rem;
					padding: 1rem 0.5rem;
					font-size: var(--fs-body-sm);
				}
			}
		}
		.budgetSummary {
			margin-inline: auto;
			width: fit-content;
			text-align: center;
			display: flex;
			flex-direction: column;
			align-items: center;
			margin-top: 1rem;
			h2 {
				font-size: var(--fs-heading-1);
				width: fit-content;
			}
			p {
				font-size: var(--fs-smallest);
				color: var(--neutral-dark-grey);
				opacity: 1;
				width: fit-content;
			}
		}
		.donutSection {
			margin-bottom: 1rem;
			.sectionTitle {
				margin-block: 2rem 1rem;
			}
		}
		.budgetSection {
			padding: 0;
			display: flex;
			flex-direction: column;
			background-color: var(--neutral-light-beige);
			gap: 1rem;
		}
		@media (min-width: 768px) {
			main {
				padding: 2.5rem;
			}
			.donutSection {
				display: flex;
				flex-direction: row;
				padding: 2rem;
				.donutWrapper,
				.spendingSummary {
					width: 50%;
				}

				/* .donutWrapper {
					display: flex;
					flex-direction: column-reverse;
				} */
			}
		}
	</style>
</Layout>
